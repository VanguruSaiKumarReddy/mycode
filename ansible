# --- CIS 1.3.2.b â€” chrony pool present in /etc/chrony.conf ---

- name: "CIS 1.3.2.b | Ensure chrony is installed"
  package:
    name: chrony
    state: present
  tags: ['cis_1_3_2_b','cis','chrony']

- name: "CIS 1.3.2.b | Ensure a 'pool' line exists in /etc/chrony.conf"
  lineinfile:
    path: /etc/chrony.conf
    regexp: '^\s*pool\s+'
    line: "pool {{ cis_chrony_pool | default('2.rhel.pool.ntp.org iburst') }}"
    create: yes
    mode: '0644'
  notify: restart_chronyd
  tags: ['cis_1_3_2_b','cis','chrony']

- name: "CIS 1.3.2.b | Enable & start chronyd"
  service:
    name: chronyd
    enabled: true
    state: started
  tags: ['cis_1_3_2_b','cis','chrony']




- name: restart_chronyd
  service:
    name: chronyd
    state: restarted



# Show the pool line (control expects any non-empty match)
grep -E '^\s*pool\s+.+$' /etc/chrony.conf

# Confirm chronyd is running and sources look healthy
systemctl is-active chronyd
chronyc -n sources -v
